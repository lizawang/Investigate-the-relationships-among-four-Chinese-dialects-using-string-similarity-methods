# [Needleman-Wunsh Alignment](https://en.wikipedia.org/wiki/Needleman%E2%80%93Wunsch_algorithm)
## Match/mismatch scoring
- Cosine similarity is applied upon the characters in the strings/sentences using (300,) context vectors of the characters that are generated by the pretrained Mandarin character vectors from [fasttext](https://fasttext.cc/docs/en/crawl-vectors.html) (which is trained using CBOW with position-weights, in dimension 300, with character n-grams of length 5, a window of size 5 and 10 negatives.).
- For the characters that are not in the pretrained model, it will return a vector of all 0 which causes "divide by 0 error" when computing the cosine simialrity. To avoid this, a random value between -1 and 1 (including 1 and -1) with interval 0.1 is drawn each run time for characters with a vector of 0. (For this reason, 𠲎 is changed into 伐 in both Shanghainese and Wenzhounese because the former character doesn't exist in modern Mandarin.)
- The benefit of using cosine similarity instead of using just fixed values for matching and mismatching is that it provides a value for every character pair based on how similar their context vector is. So that 你 ('you' in Mandarin) and 侬 ('you' in Shanghainese) get a higher matching score than 你 ('you' in Mandarin) and 伐 (genative in Shanghainese).
## Gap penalty
- It is set to 0 to make sure that the alignment is fully imposed by the characters' cosine similarity values (-1 to 1). <br>
- In this way, the two strings align along the characters that have highest cosine similarities (the same characters that two sentences share). 

```
Sentence Alignment:  124
不要玩钥匙-----
---钥匙孛相勿来个
Sentence Alignment:  109
随时问任何问题都可以-
-有---问题就问好唻
```
- The rest is also aligned by cosine similarity value from large to small. <br>
Why extra "-"? Why not just "为什么-" with "啥个道理" or "-为什么" with "啥个道理"? Because "啥" has the higher similairty score with "什" than "为". The same reason for the second example because "辰" has a much higher similairty score with "候" than "时".
```
Sentence Alignment:  19
她昨天为什么--不来
伊昨日-啥个道理勿来
Sentence Alignment:  91
我年轻的时候-常常去打棒球
我年轻个-辰光常常去打棒球
```
## Final alignment distance score for each sentence pair
- Each sentence alignment distance score is normalized by the aligned sentence length (after gap symbol '-' is added).
- The values are between -1 (theoritically when all character pairs have cosine similarity -1) and 1 (when the shorter sentence is aligned with the longer sentence with all identical characters or two sentences are totally identical.)
